# Pinocchio Escrow

一款基于 Pinocchio 框架打造的 **Solana 生态轻量级金库（托管）合约**，专为区块链新手/开发者设计，聚焦「资产安全托管、条件触发转账」核心能力，适配 SPL Token 全流程交互，代码结构清晰、注释完善，新手可快速上手二次开发！

## 🌟 核心优势（新手友好版）
### 1. 安全易理解
- 零信任托管逻辑：资产锁定/转账全由程序自动校验，无需信任第三方，新手也能清晰理解安全机制
- 内置 PDA（程序派生地址）权限控制：杜绝私钥直接操作风险，符合 Solana 合约安全最佳实践
- 完整的账户验证 + 错误处理：每一步操作都有明确的校验逻辑，错误提示清晰，新手排障更轻松

### 2. 高性能易实操
- 适配 Solana 高 TPS 特性：交易执行毫秒级响应，新手体验流畅无卡顿
- 原子性交易保障：要么全成功、要么全回滚，避免新手开发中出现「部分转账」的异常情况
- 全流程适配 SPL Token：支持主流代币的锁定、触发转账、解锁，新手无需额外适配代币逻辑

### 3. 易集成易扩展
- 代码结构模块化：核心逻辑拆分清晰，新手可按需修改/新增功能
- 可直接集成到 DApp、量化工具或 DeFi 协议中：学完即可落地实操，快速验证自己的开发思路

## 📚 快速入门（新手必看）
### 1. 环境准备
确保本地已安装以下工具（新手建议按顺序安装）：
```bash
# 安装 Solana 命令行工具（适配1.16+版本）
sh -c "$(curl -sSfL https://release.solana.com/v1.16.0/install)"

# 安装 Rust 环境（适配1.70+版本）
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# 安装 Pinocchio 框架（轻量级 Solana 开发框架）
cargo install pinocchio-cli
```

### 2. 编译合约
```bash
# 克隆仓库
git clone https://github.com/ele-gogo/pinocchio_escrow.git
cd pinocchio_escrow

# 编译为 Solana 兼容的 WASM 格式
cargo build --target wasm32-unknown-unknown --release
```

### 3. 运行测试（验证核心功能）
```bash
# 执行所有测试用例，新手可通过测试日志理解合约逻辑
cargo test
```

### 4. 部署合约（本地测试网）
```bash
# 启动本地 Solana 测试网
solana-test-validator

# 部署编译后的合约（替换为实际 WASM 文件路径）
solana program deploy target/wasm32-unknown-unknown/release/pinocchio_escrow.wasm
```

## 📖 核心功能说明（新手版）
| 功能模块       | 作用说明                                                                 | 新手学习重点                     |
|----------------|--------------------------------------------------------------------------|----------------------------------|
| 资产锁定       | 将 SPL Token 存入合约托管，由 PDA 控制资产权限                           | 理解 PDA 地址生成与权限校验逻辑  |
| 条件触发转账   | 满足预设条件（如时间、接收方验证）后，自动将资产划转至目标账户           | 学习原子性交易与条件判断实现     |
| 资产解锁/退款  | 未满足触发条件时，发起退款操作，将托管资产返还给原持有人                 | 掌握账户数据修改与代币划转流程   |
| 账户验证       | 全流程校验账户合法性、代币余额、权限归属，避免非法操作                   | 理解 Solana 账户模型与校验规范   |

## 📂 代码结构（新手易懂版）
```
pinocchio_escrow/
├── src/
│   ├── lib.rs          # 程序入口 + 指令分发（总控台，新手先看这里）
│   ├── state.rs        # 金库数据结构定义（定义「金库长什么样」）
│   ├── errors.rs       # 错误类型与提示（全中文注释，新手排障参考）
│   ├── instructions/   # 核心功能实现（按功能拆分，新手逐模块学习）
│      ├── create.rs   # 创建金库 + 锁定资产
│      ├── execute.rs  # 触发条件 + 划转资产
│      ├── refund.rs   # 退款操作 + 关闭金库
│   │  └── helper.rs   # 辅助工具（账户验证、数据初始化，新手可后看）
│   
├── Cargo.toml          # 依赖配置（新手无需修改，按需添加依赖）
└── README.md           # 本说明文档
```

## 🎯 新手学习路线
1. 先运行「环境准备+编译+测试」流程，熟悉 Solana 合约开发基础操作；
2. 阅读 `src/state.rs` 理解金库数据结构，搞懂「合约要存哪些数据」；
3. 查看 `src/instructions/create.rs` 学习「如何创建金库并锁定资产」；
4. 依次学习 `execute.rs`/`refund.rs`，掌握核心交易逻辑；
5. 尝试修改「触发条件」（如添加时间限制），完成第一次二次开发。

## 🚨 新手注意事项
1. 本合约为「学习/测试用」，请勿直接部署到 Solana 主网；若需上主网，需补充安全审计与边界条件校验；
2. Pinocchio 框架为轻量级框架，无 std 标准库，部分 API 与 Anchor 框架略有差异，但更适合新手入门；
3. 开发中若遇到报错，优先查看 `errors.rs` 中的错误定义，或通过 `solana logs` 查看交易日志。

## 🤝 贡献指南
新手也能参与贡献！
1. Fork 本仓库；
2. 基于 `dev` 分支创建功能分支（如 `feat/new-trigger-condition`）；
3. 提交代码（建议添加详细注释，方便其他新手理解）；
4. 发起 Pull Request，描述修改内容与用途。

## 📞 交流与支持
若学习过程中遇到问题，可通过以下方式交流：
- GitHub Issues：提交你的问题/建议
- Solana 中文社区：分享你的学习心得与开发问题

---
⭐️ 喜欢本项目？点个 Star 支持一下！一起完善 Solana 生态新手友好型工具～
#Solana #Web3 #智能合约 #区块链新手 #DeFi #开源
